From d1611a8125525f621fc5113a88604146c1ad049c Mon Sep 17 00:00:00 2001
Message-Id: <d1611a8125525f621fc5113a88604146c1ad049c.1502135873.git.jan.steffens@gmail.com>
In-Reply-To: <266ddc3e38107862811927371cbf4b88fdfe4872.1502135873.git.jan.steffens@gmail.com>
References: <266ddc3e38107862811927371cbf4b88fdfe4872.1502135873.git.jan.steffens@gmail.com>
From: "Jan Alexander Steffens (heftig)" <jan.steffens@gmail.com>
Date: Mon, 7 Aug 2017 20:55:35 +0200
Subject: [PATCH 2/3] meson: Use include_directories references throughout

---
 contrib/gdk-pixbuf-xlib/meson.build   | 2 ++
 docs/reference/gdk-pixbuf/meson.build | 5 ++---
 gdk-pixbuf/meson.build                | 8 +++++---
 tests/meson.build                     | 2 +-
 4 files changed, 10 insertions(+), 7 deletions(-)

diff --git a/contrib/gdk-pixbuf-xlib/meson.build b/contrib/gdk-pixbuf-xlib/meson.build
index 71b50be3f8567c57..34f945b79ed599a6 100644
--- a/contrib/gdk-pixbuf-xlib/meson.build
+++ b/contrib/gdk-pixbuf-xlib/meson.build
@@ -10,6 +10,8 @@ gdkpixbuf_xlib_headers = [
   'gdk-pixbuf-xlibrgb.h',
 ]
 
+gdkpixbuf_xlib_inc = include_directories('.')
+
 gdkpixbuf_xlib_api_path = join_paths('gdk-pixbuf-@0@'.format(gdk_pixbuf_api_version), 'gdk-pixbuf-xlib')
 
 install_headers(gdkpixbuf_xlib_headers, subdir: gdkpixbuf_xlib_api_path)
diff --git a/docs/reference/gdk-pixbuf/meson.build b/docs/reference/gdk-pixbuf/meson.build
index 6762d8da44f5c57c..5d7c9b6c1cc26579 100644
--- a/docs/reference/gdk-pixbuf/meson.build
+++ b/docs/reference/gdk-pixbuf/meson.build
@@ -28,9 +28,8 @@ if get_option('with_docs')
   gnome.gtkdoc('gdk-pixbuf',
                main_xml: 'gdk-pixbuf.xml',
                src_dir: [
-                 join_paths(meson.source_root(), 'gdk-pixbuf'),
-                 join_paths(meson.build_root(), 'gdk-pixbuf'),
-                 join_paths(meson.source_root(), 'contrib', 'gdk-pixbuf-xlib'),
+                 gdk_pixbuf_inc,
+                 gdkpixbuf_xlib_inc,
                ],
                dependencies: gdk_pixbuf_deps,
                gobject_typesfile: 'gdk-pixbuf.types',
diff --git a/gdk-pixbuf/meson.build b/gdk-pixbuf/meson.build
index c52728220b9fc68a..bc4ef4ff26b772e6 100644
--- a/gdk-pixbuf/meson.build
+++ b/gdk-pixbuf/meson.build
@@ -21,6 +21,8 @@ loaders = [
   [ 'qtif', [ 'io-qtif.c' ] ]
 ]
 
+gdk_pixbuf_inc = include_directories('.')
+
 gdk_pixbuf_cflags = [
   '-DG_LOG_STRUCTURED=1',
   '-DG_LOG_DOMAIN="GdkPixbuf"',
@@ -102,7 +104,7 @@ foreach l: loaders
     mod = static_library('staticpixbufloader-@0@'.format(name),
                          sources,
                          dependencies: loaders_deps + gdk_pixbuf_deps,
-                         include_directories: [ root_inc, include_directories('.') ],
+                         include_directories: [ root_inc, gdk_pixbuf_inc ],
                          c_args: common_cflags + gdk_pixbuf_cflags)
 
     included_loaders_deps += declare_dependency(link_with: mod)
@@ -138,29 +140,29 @@ foreach l: loaders
     mod = shared_module('pixbufloader-@0@'.format(name),
                         sources,
                         dependencies: loaders_deps + gdk_pixbuf_deps + [ gdkpixbuf_dep ],
-                        include_directories: [ root_inc, include_directories('.') ],
+                        include_directories: [ root_inc, gdk_pixbuf_inc ],
                         c_args: common_cflags + gdk_pixbuf_cflags,
                         install: true,
                         install_dir: gdk_pixbuf_loaderdir)
 
     # We need the path to build loaders.cache for tests
     dynamic_loaders += mod.full_path()
   endif
 endforeach
 
 gdkpixbuf_bin = [
   [ 'gdk-pixbuf-csource' ],
   [ 'gdk-pixbuf-pixdata' ],
   [ 'gdk-pixbuf-query-loaders', [ 'queryloaders.c' ] ],
 ]
 
 foreach bin: gdkpixbuf_bin
   bin_name = bin[0]
   bin_source = bin.get(1, bin_name + '.c')
 
   bin = executable(bin_name, bin_source,
                    dependencies: gdk_pixbuf_deps + [ gdkpixbuf_dep ],
-                   include_directories: [ root_inc, include_directories('.') ],
+                   include_directories: [ root_inc, gdk_pixbuf_inc ],
                    c_args: common_cflags + gdk_pixbuf_cflags,
                    install: true)
 
diff --git a/tests/meson.build b/tests/meson.build
index a40ea94135316003..33694e5383bc6c43 100644
--- a/tests/meson.build
+++ b/tests/meson.build
@@ -112,7 +112,7 @@ foreach t: installed_tests
                         dependencies: test_deps,
                         include_directories: [
                           root_inc,
-                          include_directories('../gdk-pixbuf')
+                          gdk_pixbuf_inc,
                         ],
                         c_args: common_cflags)
 
-- 
2.13.2

